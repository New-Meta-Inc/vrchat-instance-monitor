# 変更履歴

## [3.0.0] - 2025-11-20

### 🎉 決定的な修正 - includeInstances=true パラメータの発見

#### 変更内容
- **includeInstances=true パラメータを発見**: VRChatウェブサイトのネットワークトラフィックを分析して発見
- **`GET /worlds/{worldId}?includeInstances=true`** で実際のインスタンス情報を取得可能
- **コードを簡素化**: 不要な `get_world_instances()` メソッドを削除

#### 問題の原因
- `GET /worlds/{worldId}` エンドポイントはデフォルトでは `instances` フィールドに空データを返す
- **`includeInstances=true`** パラメータを追加すると実際のインスタンス情報を返す
- VRChatウェブサイトもこのパラメータを使用している

#### 解決方法
- `get_world_info()` メソッドに `params={'includeInstances': 'true'}` を追加
- これにより、ワールド情報と一緒にインスタンス情報を取得できる

#### 修正されたメソッド
- `get_world_info()`: `includeInstances=true` パラメータを追加
- `collect_data()`: 簡素化して `get_world_info()` から直接インスタンス情報を取得

#### 削除されたメソッド
- `get_world_instances()`: 不要になったため削除予定

## [2.0.0] - 2025-11-20

### 🎉 重大な修正 - インスタンス情報取得の根本的な問題を解決

#### 変更内容
- **新しいAPIエンドポイントを使用**: `/worlds/{worldId}/instances` エンドポイントを使用してインスタンス情報を取得
- **フォールバック機能**: 新しいエンドポイントが失敗した場合は、旧エンドポイントのデータを使用
- **認証の強化**: 新しいエンドポイントは認証が必須のため、認証処理を改善

#### 問題の原因
- `GET /worlds/{worldId}` エンドポイントは `instances` フィールドに `[null, null]` のような空データを返す仕様
- 認証済みでも実際のインスタンス情報は返さない
- VRChatウェブサイトでは522人のユーザーが表示されているのに、APIでは0人と表示される問題

#### 解決方法
- `GET /worlds/{worldId}/instances` エンドポイントを使用
- このエンドポイントは実際のインスタンス情報を返す（認証必須）

#### 新しいメソッド
- `get_world_instances()`: ワールドのインスタンス情報を取得する新しいメソッド

#### 修正されたメソッド
- `collect_data()`: 新しいエンドポイントを使用するように修正
- フォールバック機能を追加して、新しいエンドポイントが失敗した場合は旧データを使用

## [1.1.0] - 2025-11-20

### 追加
- **デバッグモード**: `DEBUG=true`環境変数で詳細ログを有効化
- **詳細なエラーハンドリング**: API応答の検証を強化
- **レスポンス検証**: インスタンスデータの型チェックと構造検証
- **詳細なログ出力**: 各処理ステップでの状態を記録

### 改善
- **インスタンス数0の問題を修正**: APIレスポンスの検証を強化し、データ取得失敗時に詳細なエラー情報を出力
- **エラーメッセージの改善**: 問題の原因を特定しやすい詳細なログメッセージ
- **データ検証の強化**: 各インスタンスデータの構造を検証してから処理
- **警告メッセージの追加**: ユーザーが存在するのにインスタンス情報が取得できない場合に警告

### 修正
- インスタンスリストが空の場合の処理を改善
- APIレスポンスの型チェックを追加
- インスタンスデータの要素数検証を追加

## [1.0.1] - 2025-11-20

### 追加
- **python-dotenvライブラリ**: .envファイルの自動読み込み機能
- **自動環境変数読み込み**: スクリプト起動時に.envファイルを自動検出・読み込み

### 改善
- READMEに.env自動読み込み機能の説明を追加
- requirements.txtにpython-dotenvを追加

## [1.0.0] - 2025-11-20

### 初回リリース
- VRChatワールドのインスタンス監視機能
- 10分ごとのデータ収集
- テキストファイルへの記録
- 認証情報の安全な管理
- Cookie自動保存・再利用
- レート制限対策
