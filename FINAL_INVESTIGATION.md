# VRChat API最終調査結果

## 結論

**`/worlds/{worldId}/instances` エンドポイントは存在しません。**

## 調査結果

### 存在するエンドポイント

VRChat APIドキュメントによると、以下のエンドポイントのみが存在します:

1. **`GET /worlds/{worldId}`** - ワールド情報を取得
   - `instances` フィールドは `[null, null]` のような空データを返す

2. **`GET /worlds/{worldId}/{instanceId}`** - 特定のインスタンス情報を取得
   - インスタンスIDが必要

3. **`GET /instances/{worldId}:{instanceId}`** - インスタンス情報を取得（別の形式）
   - インスタンスIDが必要

### 問題点

- **インスタンスIDのリストを取得する公式APIエンドポイントが存在しない**
- `GET /worlds/{worldId}` の `instances` フィールドは実際のデータを返さない
- 個別のインスタンス情報を取得するには、事前にインスタンスIDを知る必要がある

## VRChatウェブサイトの仕組み

VRChatウェブサイト（https://vrchat.com/home/world/{worldId}）では、アクティブなインスタンスリストが表示されています。

これは以下のいずれかの方法で実現されていると考えられます:

1. **非公開APIエンドポイント**: 公式ドキュメントに記載されていない内部API
2. **GraphQL API**: REST APIとは別のGraphQL APIを使用
3. **WebSocket**: リアルタイムデータストリーミング
4. **サーバーサイドレンダリング**: サーバー側で直接データベースにアクセス

## 解決策の選択肢

### 選択肢1: VRChatウェブサイトのスクレイピング（推奨）

**方法**:
- `https://vrchat.com/home/world/{worldId}` にアクセス
- HTMLをパースしてインスタンス情報を抽出
- または開発者ツールでネットワークトラフィックを監視して内部APIを特定

**利点**:
- 実際に動作している方法
- インスタンスリストを取得できる

**欠点**:
- 公式APIではない
- HTML構造が変更される可能性
- レート制限が厳しい可能性

### 選択肢2: 既知のインスタンスのみ監視

**方法**:
- ユーザーが手動でインスタンスIDを指定
- 指定されたインスタンスのみ監視

**利点**:
- 公式APIを使用
- 安定している

**欠点**:
- 新しいインスタンスを自動検出できない
- ユーザーの要求を満たせない

### 選択肢3: VRChat公式に問い合わせ

**方法**:
- VRChat公式に機能追加をリクエスト
- または非公開APIの利用許可を求める

**利点**:
- 公式サポート

**欠点**:
- 時間がかかる
- 承認されない可能性

## 推奨アプローチ

**選択肢1（VRChatウェブサイトのスクレイピング）を実装する**

理由:
- ユーザーの要求を満たせる唯一の方法
- VRChatウェブサイト自体が同じデータを表示している
- 技術的に実現可能

### 実装方法

1. **ブラウザの開発者ツールでネットワークトラフィックを監視**
2. **VRChatウェブサイトが使用している内部APIを特定**
3. **そのAPIを直接呼び出す**

または

1. **Seleniumやplaywright でブラウザを自動化**
2. **ログイン後にワールドページにアクセス**
3. **HTMLをパースしてインスタンス情報を抽出**

## セッション制限の問題

VRChat APIには以下の警告があります:

> **WARNING: Session Limit**: Each authentication with login credentials counts as a separate session, out of which you have a limited amount.

現在のスクリプトは再認証を繰り返すため、セッション制限に達する可能性があります。

**対策**:
- `auth` cookieを保存して再利用（既に実装済み）
- 再認証の回数を制限する
- 認証失敗時は一定時間待機する
